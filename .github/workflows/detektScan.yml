name: Scan with Detekt

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  schedule:
    - cron: '33 23 * * 1'
  workflow_dispatch:

env:
  DETEKT_RELEASE_TAG: v1.15.0

jobs:
  scan:
    name: Scan
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v3

    - name: Get Detekt download URL
      id: detekt_info
      run: |
        gh_response=$(gh api graphql --raw-field query='
          query getReleaseAssetDownloadUrl {
            repository(name: "detekt", owner: "detekt") {
              release(tagName: "'"$DETEKT_RELEASE_TAG"'") {
                releaseAssets(name: "detekt", first: 1) {
                  nodes {
                    downloadUrl
                  }
                }
              }
            }
          }')
        DETEKT_DOWNLOAD_URL
